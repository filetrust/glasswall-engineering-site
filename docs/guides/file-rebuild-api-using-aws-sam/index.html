<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Glasswall Engineering Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Glasswall Engineering Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-165717322-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-165717322-1",{})</script><title data-react-helmet="true">File Rebuild using AWS Serverless Application Model (SAM) | Glasswall Engineering</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="File Rebuild using AWS Serverless Application Model (SAM) | Glasswall Engineering"><meta data-react-helmet="true" name="description" content="Background"><meta data-react-helmet="true" property="og:description" content="Background"><meta data-react-helmet="true" property="og:url" content="https://filetrust.github.io/docs/guides/file-rebuild-api-using-aws-sam"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://filetrust.github.io/docs/guides/file-rebuild-api-using-aws-sam"><link rel="stylesheet" href="/styles.da32d817.css">
<link rel="preload" href="/styles.8bdb5a7e.js" as="script">
<link rel="preload" href="/runtime~main.7480d5ce.js" as="script">
<link rel="preload" href="/main.5c83b5d8.js" as="script">
<link rel="preload" href="/1.68dd110e.js" as="script">
<link rel="preload" href="/2.13e052e7.js" as="script">
<link rel="preload" href="/73.16000897.js" as="script">
<link rel="preload" href="/74.e8c54fe8.js" as="script">
<link rel="preload" href="/935f2afb.b472d86e.js" as="script">
<link rel="preload" href="/17896441.82c4c088.js" as="script">
<link rel="preload" href="/fd64a059.710d0528.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/glasswall_logo_blue.png" alt="Glasswall Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/glasswall_logo_blue.png" alt="Glasswall Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Glasswall Engineering</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/product-descriptions/product-overview">Documentation</a><a href="https://medium.com/glasswall-engineering" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a class="navbar__item navbar__link" href="/docs/careers/rules-of-engagement">Careers</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/filetrust" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">üåû</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/glasswall_logo_blue.png" alt="Glasswall Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/glasswall_logo_blue.png" alt="Glasswall Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Glasswall Engineering</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/product-descriptions/product-overview">Documentation</a></li><li class="menu__list-item"><a href="https://medium.com/glasswall-engineering" target="_blank" rel="noopener noreferrer" class="menu__link">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/careers/rules-of-engagement">Careers</a></li><li class="menu__list-item"><a href="https://github.com/filetrust" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">File Rebuild using AWS Serverless Application Model (SAM)</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="background"></a>Background<a class="hash-link" href="#background" title="Direct link to heading">#</a></h2><p>The File Rebuild Product leverages azure serverless functions, with an AWS gateway api
redirecting requests and limiting usage. The purpose of this exercise was to convert the
azure components to AWS counterpart Lambda‚Äôs.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="solution-overview"></a>Solution Overview<a class="hash-link" href="#solution-overview" title="Direct link to heading">#</a></h2><p>The Azure Function relies on a multipart binary file being in the body of the request, however
this does not work as expected on a deployed Lambda, since decoding of the incoming
lambda request seems to lose the content when received by the code. Two endpoints have
been produced to allow for alternative mechanisms for file rebuild:</p><p>The following endpoints can be reused by other products, provided they have a way of
converting a file to base64 or providing a URL to a file. A good way of using the API would
be by leveraging the s3 file upload product. Refer to the S3 File Upload Product
documentation to find out how to generate read SAS tokens that can be used on this API</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="endpoints"></a>Endpoints<a class="hash-link" href="#endpoints" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="apirebuildbase64"></a>/api/Rebuild/base64<a class="hash-link" href="#apirebuildbase64" title="Direct link to heading">#</a></h3><p>  <strong>Example Workflow Diagram:</strong></p><p>  <img alt="Figure11" src="/assets/images/Figure11-e641470de7d84c9c0f45e6a7f8fa516e.png"></p><p>  This endpoint allows a client service to send a base64 encoding of a file in the body. A
limitation of this however, is that you cannot send a file larger than lambda‚Äôs maximum
request size of 6MB.</p><p>  <strong>Example Request Generated by Postman:</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl --location --request POST &#x27;[API GATEWAY URL]/api/Rebuild/base64&#x27; \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--header &#x27;Content-Type: application/json&#x27; \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--data-raw &#x27;{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Base64&quot;: ‚Äú[YOUR BASE64 GOES HERE]‚Äù,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">‚ÄúFileName‚Äù: ‚ÄúExample.txt‚Äù</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}‚Äô </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>  This endpoint does the following:</p><ul><li><p>Downloads the file found at SasUrl using a GET request.</p><ul><li><p>If it is unsuccessful it returns BAD REQUEST</p></li><li><p>If it is successful then it will send the file to the core engine.</p></li></ul></li><li><p>File name is extracted from the URL.</p></li><li><p>The core engine will then try and determine the file type</p></li><li><p>The file is protected with the default content management flags for the file type.</p></li><li><p>Protected file is returned</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="apirebuildsas"></a>/api/Rebuild/sas<a class="hash-link" href="#apirebuildsas" title="Direct link to heading">#</a></h3><p>  <img alt="Figure12" src="/assets/images/Figure12-1868cb63e25638ceb88d32d0a756f18c.png"></p><p>  This endpoint allows a client to send a SAS url to a file to be downloaded and have its file
rebuilt. An added benefit of this is the benefit of being able to upload files over the 6MB size
threshold.</p><p>  <strong>Example Request Generated by Postman:</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  curl --location --request POST &#x27;[API GATEWAY URL]/api/Rebuild/sas&#x27; \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --header &#x27;Content-Type: application/json&#x27; \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        --data-raw &#x27;{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           &quot;SasUrl&quot;: &quot;[YUR SAS URL GOES HERE]&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>  This endpoint does the following:</p><ul><li>Downloads the file found at SasUrl using a GET request.<ul><li>If it is unsuccessful it returns BAD REQUEST</li><li>If it is successful then it will send the file to the core engine.</li></ul></li><li>File name is extracted from the URL.</li><li>The core engine will then try and determine the file type</li><li>The file is protected with the default content management flags for the file type.</li><li>Protected file is returned</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="deployment-option---1-using-visual-studio-ide"></a>Deployment Option - 1: Using Visual Studio IDE<a class="hash-link" href="#deployment-option---1-using-visual-studio-ide" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="pre-requisites"></a>Pre-requisites<a class="hash-link" href="#pre-requisites" title="Direct link to heading">#</a></h3><ol><li>Visual Studio 2017 or 2019 installed.</li><li>AWS Toolkit extension for visual studio</li><li>AWS SAM CLI</li><li>Credentials configured for AWS</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="steps"></a>Steps:<a class="hash-link" href="#steps" title="Direct link to heading">#</a></h3><ol><li>Clone repo <a href="https://github.com/filetrust/cloud-serverless-sdk" target="_blank" rel="noopener noreferrer">https://github.com/filetrust/cloud-serverless-sdk</a></li><li>Open .sln file Glasswall.CloudSdk.AWS</li><li>Right click on project Glasswall.Cloudsdk.AWS.Rebuild</li><li>Click publish to AWS lambda</li><li>For options:<ol><li>Account profile: Choose one that has permissions to create a cloud formation.</li><li>Region: Where the lambda will run</li><li>Stack name: This will be what the name of the stack the cloud formation will
use, resources will use this in their name.</li><li>S3 bucket: The bucket where the source code will be zipped and uploaded
too</li></ol></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="deployment-option---2-manually-create-cloud-formation"></a>Deployment Option - 2: Manually create cloud formation<a class="hash-link" href="#deployment-option---2-manually-create-cloud-formation" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="pre-requisites-1"></a>Pre-requisites<a class="hash-link" href="#pre-requisites-1" title="Direct link to heading">#</a></h3><ol><li>An aws account</li><li>Permissions to create cloud formations</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="steps-1"></a>Steps:<a class="hash-link" href="#steps-1" title="Direct link to heading">#</a></h3><ol><li><p>Create a bucket for the deployed code.</p></li><li><p>Upload Deployment zip into bucket, take note of the name</p></li><li><p>Edit serverless.template file, update the codeuri field to reflect the location of the
deployment.</p><ul><li>Format example: s3://nameofbucket/nameoffolder/nameof.zip</li></ul></li><li><p>Log on to aws</p></li><li><p>Navigate to AWS CloudFormation</p></li><li><p>Create a stack
<img alt="Figure13" src="/assets/images/Figure13-ea8e13134c30ccce90379b9799587cd8.png"></p></li><li><p>Select serverless.template from disk
<img alt="Figure14" src="/assets/images/Figure14-c4f79d4beec1b856c98a7c3011b03bda.png"></p></li><li><p>Enter a name for the stack</p></li><li><p>Click next until end and finish</p></li></ol></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#background" class="table-of-contents__link">Background</a></li><li><a href="#solution-overview" class="table-of-contents__link">Solution Overview</a></li><li><a href="#endpoints" class="table-of-contents__link">Endpoints</a><ul><li><a href="#apirebuildbase64" class="table-of-contents__link">/api/Rebuild/base64</a></li><li><a href="#apirebuildsas" class="table-of-contents__link">/api/Rebuild/sas</a></li></ul></li><li><a href="#deployment-option---1-using-visual-studio-ide" class="table-of-contents__link">Deployment Option - 1: Using Visual Studio IDE</a><ul><li><a href="#pre-requisites" class="table-of-contents__link">Pre-requisites</a></li><li><a href="#steps" class="table-of-contents__link">Steps:</a></li></ul></li><li><a href="#deployment-option---2-manually-create-cloud-formation" class="table-of-contents__link">Deployment Option - 2: Manually create cloud formation</a><ul><li><a href="#pre-requisites-1" class="table-of-contents__link">Pre-requisites</a></li><li><a href="#steps-1" class="table-of-contents__link">Steps:</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/products/cloud-sdk/rebuild/rebuild-quickstart">Getting Started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/glasswall" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/filetrust" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://twitter.com/glasswallglobal" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://www.linkedin.com/company/glasswall-solutions-limited/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2021 Glasswall Solutions Ltd. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.8bdb5a7e.js"></script>
<script src="/runtime~main.7480d5ce.js"></script>
<script src="/main.5c83b5d8.js"></script>
<script src="/1.68dd110e.js"></script>
<script src="/2.13e052e7.js"></script>
<script src="/73.16000897.js"></script>
<script src="/74.e8c54fe8.js"></script>
<script src="/935f2afb.b472d86e.js"></script>
<script src="/17896441.82c4c088.js"></script>
<script src="/fd64a059.710d0528.js"></script>
</body>
</html>